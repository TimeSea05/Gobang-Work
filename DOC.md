# 程序说明

## 1. 程序结构

* /include

| `ai.c`                     | `chess_type.h`                             | `constants.h`                    | `game_func.h`                                | `game.h`                                 |
| -------------------------- | ------------------------------------------ | -------------------------------- | -------------------------------------------- | ---------------------------------------- |
| 声明有关机器智能算法的函数 | 存储有关五子棋各个棋型的信息(如活三、活四) | 存储程序中需要的枚举常量与宏定义 | 声明有关游戏运行的函数(如落子函数、禁手函数) | 声明有关棋型判定的函数(如判断活三、活四) |

* /src

| `ai.c`                 | `game_func.c`                                  | `game_global_var.c`                        | `game.c`               | `main.c`     |
| ---------------------- | ---------------------------------------------- | ------------------------------------------ | ---------------------- | ------------ |
| 机器智能算法函数的实现 | 有关游戏运行的函数(如落子函数、禁手函数)的实现 | 存储游戏全局变量(如棋盘、刚下的棋子的位置) | 有关棋型判定函数的实现 | 程序的主函数 |

* /.vscode

使用VSCode for Linux开发时的配置文件

* /images

`ex.png`: 程序运行快照

* Makefile

GNU Makefile 用来编译程序

* /output

`main`: 编译得到的二进制文件

## 2. 编写思路

### 2.1 棋盘

本程序中将棋盘在终端中打印出来，思路来自于**武成岗**老师。但武成岗老师的棋盘为GBK编码，在`Ubuntu Desktop`的开发环境下，非常容易导致程序乱码，甚至会导致源文件乱码而不可用。因此我将原来GBK编码的棋盘更改为UTF-8编码。

更改的方法为使用标准库`stddef.h`中定义的`wchar_t`类型存储宽字符(大于一个字节的字符)，在打印棋盘时，应首先使用

```c
setlocale(LC_ALL, "");
```

保证宽字符正常输出，输出时使用`printf`函数，占位符为`%lc`

```c
printf("%lc", display_board_array[i][j]);
```

### 2.2 棋型判定

开始时我使用条件语句`if-else`进行判定。但这导致程序异常繁琐，可读性极差。在一篇博客的启发下，我开始使用字符串匹配的思路来进行棋型判定。

我们用不同的字符来代表不同的棋子。

| 空   | 白色棋子(包括白色三角) | 黑色棋子(包括黑色三角) |
| ---- | ---------------------- | ---------------------- |
| '0'  | '7'                    | '1'                    |

要获取某一点处棋型的情况，我们只需要将特定方向的棋子排列转化成字符串即可。

举个例子，比如棋子排列为  **空空空空黑黑空黑白空空空空空空**

那么我们得到的棋型字符串为 **000011017000000**

我们用获得的字符串和给定棋型的字符串进行比较，即可获得棋型相关信息

### 2.3 机器智能算法

机器智能算法采用了传统的`对抗搜索及alpha-beta剪枝算法`

在本程序中，进行搜索的思路是：以刚下的棋子的位置为中心，一圈一圈地搜索，直到搜索范围超过棋盘边界。首先搜索正方形的上下两条边(棋盘是正方形的)，再搜索正方形的左右两条边。

由于程序展开过于繁琐，故此处使用宏函数减少了不必要的重复，但相应地程序的可读性也显著下降。程序的注释中提供了如何方便读懂宏函数的方法，此处不再赘述。

